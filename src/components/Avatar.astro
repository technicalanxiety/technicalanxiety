---
export interface Props {
  src: string;
  alt: string;
  size?: number;
  class?: string;
}

const { 
  src, 
  alt, 
  size = 80,
  class: className = '' 
} = Astro.props;

// For avatar images, we'll use the optimized versions if available
// but fall back gracefully to the original
const filename = src.replace('/img/', '').replace(/\.[^/.]+$/, '');
const hasOptimized = src.includes('/img/');
---

{hasOptimized ? (
  <picture class={`avatar-picture ${className}`} style={`width: ${size}px; height: ${size}px;`}>
    <!-- Try optimized AVIF first -->
    <source 
      srcset={`/img/optimized/${filename}.avif`}
      type="image/avif"
    />
    
    <!-- Try optimized WebP -->
    <source 
      srcset={`/img/optimized/${filename}.webp`}
      type="image/webp"
    />
    
    <!-- Fallback to optimized JPEG -->
    <img 
      src={`/img/optimized/${filename}.jpg`}
      alt={alt}
      width={size}
      height={size}
      loading="eager"
      decoding="async"
      onerror={`this.onerror=null; this.src='${src}';`}
      style="width: 100%; height: 100%; object-fit: cover; object-position: center 15%; border-radius: 50%;"
    />
  </picture>
) : (
  <!-- Direct image fallback -->
  <img 
    src={src}
    alt={alt}
    width={size}
    height={size}
    loading="eager"
    decoding="async"
    class={`avatar-img ${className}`}
    style={`width: ${size}px; height: ${size}px; object-fit: cover; object-position: center 15%; border-radius: 50%;`}
  />
)}

<style>
  .avatar-picture, .avatar-img {
    display: block;
    border-radius: 50%;
    overflow: hidden;
  }
  
  .avatar-picture img, .avatar-img {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    object-position: center 15% !important;
    border-radius: 50% !important;
  }
</style>